<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:AvaloniaUI.ViewModels"
        xmlns:conv="clr-namespace:AvaloniaUI.Converters"
        xmlns:views="clr-namespace:AvaloniaUI.Views"
        x:Class="AvaloniaUI.MainWindow"
        x:Name="Root"
        x:DataType="vm:MainViewModel"
        mc:Ignorable="d"
        Width="1200"
        Height="720"
        MinWidth="1000"
        MinHeight="600"
        Title="Nirvana Remap"
        Icon="/Assets/nirvanaIcon.ico"
        Background="#0e1419"
        FontFamily="Segoe UI,Arial">

    <Window.Resources>
        <conv:ValueToWidthConverter x:Key="ValueToWidthConverter" />
        <conv:InputValueConverter x:Key="InputValueConverter" />
        <conv:InputLevelConverter x:Key="InputLevelConverter" />
        <conv:StickOffsetConverter x:Key="StickOffsetConverter" />
    </Window.Resources>

    <Window.Styles>
        <Style Selector="Border.card">
            <Setter Property="Background">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                        <GradientStop Color="#1a1f26" Offset="0" />
                        <GradientStop Color="#161b21" Offset="1" />
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
            <Setter Property="BorderBrush" Value="#2a3139" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="Padding" Value="16" />
            <Setter Property="BoxShadow" Value="0 4 16 0 #00000040" />
        </Style>

        <Style Selector="Button.primary">
            <Setter Property="Background">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                        <GradientStop Color="#4a76e8" Offset="0" />
                        <GradientStop Color="#3d5fc4" Offset="1" />
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
            <Setter Property="Foreground" Value="#ffffff" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="CornerRadius" Value="6" />
            <Setter Property="Padding" Value="16,8" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>

        <Style Selector="Button.primary:pointerover">
            <Setter Property="Background">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                        <GradientStop Color="#5a86f8" Offset="0" />
                        <GradientStop Color="#4d6fd4" Offset="1" />
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
        </Style>

        <Style Selector="Button.secondary">
            <Setter Property="Background" Value="#1e2329" />
            <Setter Property="Foreground" Value="#c9d1d9" />
            <Setter Property="BorderBrush" Value="#30363d" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="6" />
            <Setter Property="Padding" Value="12,6" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>

        <Style Selector="Button.secondary:pointerover">
            <Setter Property="Background" Value="#262c33" />
            <Setter Property="BorderBrush" Value="#3d444d" />
        </Style>

        <Style Selector="Button.danger">
            <Setter Property="Background" Value="#da3633" />
            <Setter Property="Foreground" Value="#ffffff" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="CornerRadius" Value="6" />
            <Setter Property="Padding" Value="12,6" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>

        <Style Selector="TextBox">
            <Setter Property="Background" Value="#0d1117" />
            <Setter Property="Foreground" Value="#c9d1d9" />
            <Setter Property="BorderBrush" Value="#30363d" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="6" />
            <Setter Property="Padding" Value="10,8" />
        </Style>

        <Style Selector="TextBox:focus">
            <Setter Property="BorderBrush" Value="#4a76e8" />
        </Style>

        <Style Selector="ComboBox">
            <Setter Property="Background" Value="#0d1117" />
            <Setter Property="Foreground" Value="#c9d1d9" />
            <Setter Property="BorderBrush" Value="#30363d" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="6" />
            <Setter Property="Padding" Value="10,6" />
        </Style>

        <Style Selector="ListBox">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
        </Style>

        <Style Selector="ListBoxItem">
            <Setter Property="Background" Value="#161b22" />
            <Setter Property="Margin" Value="0,0,0,6" />
            <Setter Property="Padding" Value="12" />
            <Setter Property="CornerRadius" Value="6" />
            <Setter Property="BorderBrush" Value="#21262d" />
            <Setter Property="BorderThickness" Value="1" />
        </Style>

        <Style Selector="ListBoxItem:pointerover">
            <Setter Property="Background" Value="#1c2128" />
            <Setter Property="BorderBrush" Value="#30363d" />
        </Style>

        <Style Selector="ListBoxItem:selected">
            <Setter Property="Background" Value="#1c2733" />
            <Setter Property="BorderBrush" Value="#4a76e8" />
        </Style>
    </Window.Styles>

    <Grid RowDefinitions="Auto,*">
        <Border Grid.Row="0" Padding="24,20">
            <Border.Background>
                <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,0%">
                    <GradientStop Color="#1a2332" Offset="0" />
                    <GradientStop Color="#0e1419" Offset="1" />
                </LinearGradientBrush>
            </Border.Background>

            <Grid ColumnDefinitions="*,Auto">
                <StackPanel Grid.Column="0" Spacing="4">
                    <TextBlock Text="NIRVANA REMAP"
                               FontSize="28"
                               FontWeight="Bold"
                               Foreground="#ffffff"
                               LetterSpacing="2" />
                    <StackPanel Orientation="Horizontal" Spacing="16">
                        <Border Background="#2ea043"
                                CornerRadius="12"
                                Padding="10,4">
                            <TextBlock Text="{Binding Status}"
                                       FontSize="12"
                                       Foreground="#ffffff"
                                       FontWeight="SemiBold" />
                        </Border>
                        <Border Background="#30363d"
                                CornerRadius="12"
                                Padding="10,4">
                            <TextBlock Text="{Binding OutputStatusText}"
                                       FontSize="12"
                                       Foreground="#8b949e"
                                       FontWeight="SemiBold" />
                        </Border>
                    </StackPanel>
                </StackPanel>

                <StackPanel Grid.Column="1"
                            Orientation="Horizontal"
                            Spacing="12"
                            VerticalAlignment="Center">
                    <Button Content="â–¶ START"
                            Classes="primary"
                            Command="{Binding StartCommand}"
                            Width="120" />
                    <Button Content="â¹ STOP"
                            Classes="danger"
                            Command="{Binding StopCommand}"
                            Width="120" />
                </StackPanel>
            </Grid>
        </Border>

        <ScrollViewer Grid.Row="1"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled">
            <Grid ColumnDefinitions="1.2*,*"
                  Margin="24,16,24,24"
                  ColumnSpacing="20">

                <StackPanel Grid.Column="0" Spacing="16">
                    <Border Classes="card">
                        <StackPanel Spacing="16">
                            <Grid ColumnDefinitions="*,Auto">
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="HUB DE MAPEAMENTO"
                                               FontSize="18"
                                               FontWeight="Bold"
                                               Foreground="#e6edf3"
                                               LetterSpacing="1" />
                                    <TextBlock Text="Configure os controles fÃ­sicos para aÃ§Ãµes virtuais"
                                               FontSize="12"
                                               Foreground="#7d8590"
                                               Margin="0,2,0,0" />
                                </StackPanel>

                                <StackPanel Grid.Column="1"
                                            Orientation="Horizontal"
                                            Spacing="8"
                                            VerticalAlignment="Center">
                                    <Button Content="ðŸ”„ Recarregar"
                                            Classes="secondary"
                                            Command="{Binding Hub.ReloadCommand}" />
                                    <Button Content="ðŸ—‘ Limpar"
                                            Classes="secondary"
                                            Command="{Binding Hub.ClearAllCommand}" />
                                </StackPanel>
                            </Grid>

                            <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                                <TextBox Grid.Column="0"
                                         Watermark="ðŸ” Buscar aÃ§Ã£o..."
                                         Text="{Binding Hub.Filter, Mode=TwoWay}" />

                                <StackPanel Grid.Column="1"
                                            Orientation="Horizontal"
                                            Spacing="8">
                                    <TextBlock Text="PERFIL:"
                                               VerticalAlignment="Center"
                                               FontSize="12"
                                               Foreground="#7d8590"
                                               FontWeight="SemiBold" />
                                    <ComboBox Width="160"
                                              ItemsSource="{Binding Hub.AvailableProfiles}"
                                              SelectedItem="{Binding Hub.CurrentProfileId, Mode=TwoWay}" />
                                    <TextBox Width="160"
                                             Watermark="Nome do perfil"
                                             Text="{Binding Hub.NewProfileName, Mode=TwoWay}" />
                                    <Button Content="+"
                                            Classes="secondary"
                                            Width="36"
                                            Command="{Binding Hub.NewProfileCommand}" />
                                    <Button Content="Excluir"
                                            Classes="danger"
                                            Command="{Binding Hub.DeleteProfileCommand}"
                                            ToolTip.Tip="Excluir perfil" />
                                </StackPanel>
                            </Grid>

                            <ScrollViewer Height="450"
                                          VerticalScrollBarVisibility="Auto">
                                <ItemsControl ItemsSource="{Binding Hub.FilteredItems}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate x:DataType="vm:MappingItemVM">
                                            <Border Background="#0d1117"
                                                    BorderBrush="#21262d"
                                                    BorderThickness="1"
                                                    CornerRadius="6"
                                                    Padding="14"
                                                    Margin="0,0,0,8">
                                                <Grid RowDefinitions="Auto,Auto,Auto">
                                                    <Grid Grid.Row="0" ColumnDefinitions="*,Auto">
                                                        <StackPanel Grid.Column="0">
                                                            <TextBlock Text="{Binding ActionName}"
                                                                       FontSize="14"
                                                                       FontWeight="SemiBold"
                                                                       Foreground="#e6edf3" />
                                                            <TextBlock Text="{Binding AssignedDisplay}"
                                                                       FontSize="12"
                                                                       Foreground="#58a6ff"
                                                                       Margin="0,2,0,0" />
                                                        </StackPanel>

                                                        <Border Grid.Column="1"
                                                                Background="#da3633"
                                                                CornerRadius="4"
                                                                Padding="8,4"
                                                                IsVisible="{Binding HasConflict}">
                                                            <TextBlock Text="âš  CONFLITO"
                                                                       FontSize="10"
                                                                       Foreground="#ffffff"
                                                                       FontWeight="Bold" />
                                                        </Border>
                                                    </Grid>

                                                    <Grid Grid.Row="1"
                                                          ColumnDefinitions="*,Auto,Auto"
                                                          ColumnSpacing="8"
                                                          Margin="0,10,0,0">
                                                        <ComboBox Grid.Column="0"
                                                                  ItemsSource="{Binding AvailableInputs}"
                                                                  SelectedItem="{Binding Assigned, Mode=TwoWay}"
                                                                  MinWidth="180" />
                                                        <Button Grid.Column="1"
                                                                Content="ðŸŽ® Detectar"
                                                                Classes="secondary"
                                                                Command="{Binding DetectCommand}" />
                                                        <Button Grid.Column="2"
                                                                Content="âœ•"
                                                                Classes="secondary"
                                                                Width="36"
                                                                Command="{Binding ClearCommand}" />
                                                    </Grid>

                                                    <TextBlock Grid.Row="2"
                                                               Text="{Binding ConflictNote}"
                                                               FontSize="11"
                                                               Foreground="#f85149"
                                                               Margin="0,6,0,0"
                                                               IsVisible="{Binding HasConflict}" />
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>

                            <Border BorderBrush="#30363d"
                                    BorderThickness="0,1,0,0"
                                    Padding="0,12,0,0">
                                <Grid ColumnDefinitions="*,Auto">
                                    <StackPanel Grid.Column="0"
                                                Orientation="Horizontal"
                                                Spacing="8"
                                                VerticalAlignment="Center">
                                        <TextBlock Text="âš "
                                                   FontSize="16"
                                                   Foreground="#f85149" />
                                        <TextBlock Text="{Binding Hub.ConflictSummary}"
                                                   FontSize="12"
                                                   Foreground="#7d8590" />
                                    </StackPanel>

                                    <Button Grid.Column="1"
                                            Content="ðŸ’¾ SALVAR MAPEAMENTO"
                                            Classes="primary"
                                            Command="{Binding Hub.SaveCommand}"
                                            IsEnabled="{Binding Hub.CanSave}" />
                                </Grid>
                            </Border>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <StackPanel Grid.Column="1" Spacing="16">
                    <views:GamepadMonitor />

                    <Border Classes="card">
                        <StackPanel Spacing="12">
                            <Grid ColumnDefinitions="Auto,*">
                                <Border Grid.Column="0"
                                        Background="#f85149"
                                        Width="4"
                                        CornerRadius="2"
                                        Margin="0,0,12,0" />
                                <StackPanel Grid.Column="1">
                                    <TextBlock Text="MODO VIRTUAL"
                                               FontSize="16"
                                               FontWeight="Bold"
                                               Foreground="#e6edf3"
                                               LetterSpacing="1" />
                                    <TextBlock Text="HidHide + ViGEm"
                                               FontSize="11"
                                               Foreground="#7d8590" />
                                </StackPanel>
                            </Grid>

                            <TextBlock Text="Dispositivos a ocultar (Device Instance ID):"
                                       FontSize="11"
                                       Foreground="#8b949e" />

                            <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
                                <TextBox Grid.Column="0"
                                         Text="{Binding NewDeviceId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         Watermark="HID\VID_054C&amp;PID_09CC\..." />
                                <Button Grid.Column="1"
                                        Content="+ Adicionar"
                                        Classes="secondary"
                                        Command="{Binding AddDeviceIdCommand}" />
                            </Grid>

                            <ScrollViewer Height="120" VerticalScrollBarVisibility="Auto">
                                <ItemsControl ItemsSource="{Binding DevicesToHide}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="#0d1117"
                                                    BorderBrush="#21262d"
                                                    BorderThickness="1"
                                                    CornerRadius="4"
                                                    Padding="10"
                                                    Margin="0,0,0,4">
                                                <Grid ColumnDefinitions="*,Auto">
                                                    <TextBlock Grid.Column="0"
                                                               Text="{Binding .}"
                                                               FontSize="11"
                                                               FontFamily="Consolas,monospace"
                                                               Foreground="#7d8590"
                                                               TextTrimming="CharacterEllipsis"
                                                               VerticalAlignment="Center" />
                                                    <Button Grid.Column="1"
                                                            Content="âœ•"
                                                            Classes="secondary"
                                                            Width="32"
                                                            Height="24"
                                                            Command="{Binding #Root.DataContext.RemoveDeviceIdCommand}"
                                                            CommandParameter="{Binding .}" />
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>

                            <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                                <Button Grid.Column="0"
                                        Content="âœ“ Ativar OcultaÃ§Ã£o"
                                        Classes="primary"
                                        Command="{Binding EnableVirtualModeCommand}" />
                                <Button Grid.Column="1"
                                        Content="âœ• Desativar"
                                        Classes="secondary"
                                        Command="{Binding DisableVirtualModeCommand}" />
                            </Grid>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </Grid>
        </ScrollViewer>
    </Grid>
</Window>
